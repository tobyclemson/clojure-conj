<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 3.0.2 (195746)"/><meta name="keywords" content="clojure, conference, day1"/><meta name="created" content="2011-11-10 10:43:20 -0600"/><meta name="updated" content="2011-11-11 07:54:55 -0600"/><title>"ClojureScript: Under The Hood", Chris Houser</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
<div><b><a href="%22ClojureScript%3A%20Under%20The%20Hood%22,%20Chris%20Houser.resources/chouser-clojurescript.svg">chouser-clojurescript.svg</a><br/></b></div>
<div><b><br/></b></div>
Terminology
<ul>
<li>Regular Clojure: plain old Clojure</li>
<li>CLJS: ClojureScript</li>
<li>GClosure: google closure (from closure compiler)</li>
</ul>
<b>ClojureScript Pyramid</b>
<ul>
<li>   / data types \</li>
<li>  /   protocols   \</li>
<li> /     macros      \</li>
<li>/     compiler       \</li>
</ul>
<b>Data Types</b>
<ul>
<li>[a b c] - vector
<ul>
<li>cljs.core.Vector
<ul>
<li>meta: cljs Map</li>
<li>array: js Array</li>
</ul>
</li>
<li>copy on write whole new vector on change</li>
</ul>
</li>
<li>{a 1, b 2} - map
<ul>
<li>cljs.core.ObjMap
<ul>
<li>meta: cljs Map</li>
<li>keys: js Array</li>
<li>strobj: js Object of keys and vals</li>
</ul>
</li>
<li>cljs.core.HashMap
<ul>
<li>meta: cljs Map</li>
<li>count: number</li>
<li>hashobj: js Object of buckets</li>
</ul>
</li>
<li>difference is ObjMap is more sophisticated but less efficient</li>
<li>copy on write - whole new map on change</li>
</ul>
</li>
<li>#{a b c} - set
<ul>
<li>cljs.core.Set
<ul>
<li>meta: cljs Map</li>
<li>hash-map: cljs Map</li>
</ul>
</li>
</ul>
</li>
<li>All implemented in cljs itself</li>
</ul>
<b>Protocols</b>
<ul>
<li>cljs collections -> cljs protocols</li>
<li>No inheritance at all</li>
<li>In cljs, can take a type that we didn't write and extend it to adhere to cljs's own protocols</li>
<li>Not possible in regular Clojure without some sort of wrapper</li>
<li>What do you do if the type you didn't write already implements part of what you want to extend it with?
<ul>
<li>Overwrite and become authoritative</li>
<li>Leave existing implementation in place</li>
</ul>
</li>
</ul>
<div><b>Macros</b></div>
<ul>
<li>Steps:
<ul>
<li>analyse/macroexpand
<ul>
<li>gives a metadata decorated tree representing the input code</li>
</ul>
</li>
<li>emit</li>
<li>load and run</li>
<li>loop</li>
</ul>
</li>
<li>Macros are clojure code, all of this happens in the JVM</li>
</ul>
<b>Compiler</b>
<div>
<ul>
<li>[Added a feature in 5 lines during the live demo]</li>
</ul>
<b>Miscellaneous</b><br/>
<ul>
<li>(js ...) - gives the JS equivalent of a Clojure form</li>
<li><span style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium;">(js* "(~{}[~{}])" blah blah) - string interpolation of args into format string</span></li>
<li><span style="border-collapse: separate; color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium;">Unicode character used to separate keyword strings from symbol</span></li>
</ul>
<b>Questions</b></div>
<div>
<ul>
<li>Are there any plans to make the core data types more like the regular Clojure data types?
<ul>
<li>Actually, regular Clojure data types are effectively copy on write for small collections</li>
<li>Probably no need at the moment for the same in CLJS</li>
</ul>
</li>
<li>Are there any plans to improve the interop between CLJS and Javascript?
<ul>
<li>There has been some discussion on the google group</li>
</ul>
</li>
</ul>
<div><b><br/></b></div>
</div>
</body></html>